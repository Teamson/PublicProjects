window.__require=function e(t,o,n){function r(i,a){if(!o[i]){if(!t[i]){var s=i.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!a&&l)return l(s,!0);if(c)return c(s,!0);throw new Error("Cannot find module '"+i+"'")}i=s}var u=o[i]={exports:{}};t[i][0].call(u.exports,function(e){return r(t[i][1][e]||e)},u,u.exports,e,t,o,n)}return o[i].exports}for(var c="function"==typeof __require&&__require,i=0;i<n.length;i++)r(n[i]);return r}({HomeRankItem:[function(e,t,o){"use strict";cc._RF.push(t,"743f1p4/0pD4YxkBq9XLxkq","HomeRankItem");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bgNode=null,t.rankNode=null,t.rankingLabel=null,t.avatarSprite=null,t.nicknameLabel=null,t.scoreLabel=null,t}return r(t,e),t.prototype.set=function(e,t){this.rankingLabel.string=e.toString(),this.nicknameLabel.string=t.nickname,this.scoreLabel.string=t.KVDataList[0].value.toString(),this.rankNode.children[0].active=1==e,this.rankNode.children[1].active=2==e,this.rankNode.children[2].active=3==e,this.rankNode.children[3].active=e>3,this.bgNode.children[0].active=1==e,this.bgNode.children[1].active=2==e,this.bgNode.children[2].active=3==e,this.bgNode.children[3].active=e>3},t.prototype.updateAvatar=function(e){var t=this,o=window.wx.createImage();o.src=e,o.onload=function(){var e=new cc.Texture2D;e.initWithElement(o),e.handleLoadedTexture(),t.avatarSprite.spriteFrame=new cc.SpriteFrame(e)}},c([s(cc.Node)],t.prototype,"bgNode",void 0),c([s(cc.Node)],t.prototype,"rankNode",void 0),c([s(cc.Label)],t.prototype,"rankingLabel",void 0),c([s(cc.Sprite)],t.prototype,"avatarSprite",void 0),c([s(cc.Label)],t.prototype,"nicknameLabel",void 0),c([s(cc.Label)],t.prototype,"scoreLabel",void 0),c([a],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],MyItem:[function(e,t,o){"use strict";cc._RF.push(t,"c3965AXVClMM5Dcu3Eertsz","MyItem");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,s=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bgNode=null,t.rankNode=null,t.rankingLabel=null,t.nicknameLabel=null,t.scoreLabel=null,t}return r(t,e),t.prototype.set=function(e,t){this.rankingLabel.string=e.toString(),this.nicknameLabel.string=t.nickname,this.scoreLabel.string=t.KVDataList[0].value.toString(),this.rankNode.children[0].active=1==e,this.rankNode.children[1].active=2==e,this.rankNode.children[2].active=3==e,this.rankNode.children[3].active=e>3,this.bgNode.children[0].active=1==e,this.bgNode.children[1].active=2==e,this.bgNode.children[2].active=3==e,this.bgNode.children[3].active=e>3},c([s(cc.Node)],t.prototype,"bgNode",void 0),c([s(cc.Node)],t.prototype,"rankNode",void 0),c([s(cc.Label)],t.prototype,"rankingLabel",void 0),c([s(cc.Label)],t.prototype,"nicknameLabel",void 0),c([s(cc.Label)],t.prototype,"scoreLabel",void 0),c([a],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],Rank:[function(e,t,o){"use strict";cc._RF.push(t,"b649ffSTktKhpEpaKWFhFTe","Rank");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,c){function i(e){try{s(n.next(e))}catch(t){c(t)}}function a(e){try{s(n.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,a)}s((n=n.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var o,n,r,c,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return c={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function a(e){return function(t){return s([e,t])}}function s(c){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(6===c[0]&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(a){c=[6,a],n=0}finally{o=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./HomeRankItem"),l=e("./MyItem"),u=cc._decorator,p=u.ccclass,h=u.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.homeRankNode=null,t.homeScrollView=null,t.homeContent=null,t.homeItemPrefab=null,t.myItem=null,t.myNickName="",t}return r(t,e),t.prototype.onLoad=function(){var e=this;cc.sys.platform==cc.sys.WECHAT_GAME_SUB&&(window.wx.onMessage(function(t){return e.onMessage(t)}),window.wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(t){console.log("\u7528\u6237\u4fe1\u606f\uff1a",t),e.myNickName=t.data[0].nickName}}),console.log("\u5b50\u57df\u542f\u52a8"))},t.prototype.onMessage=function(e){var t=this;switch(e.event){case"showHomeRank":window.wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(e){console.log("\u7528\u6237\u4fe1\u606f\uff1a",e),t.myNickName=e.data[0].nickName}}),this.setScore(e.score),this.showHomeRank();break;case"hideHomeRank":this.hideHomeRank()}},t.prototype.getScore=function(){return new Promise(function(e){console.log("[getScore]"),window.wx.getUserCloudStorage({keyList:["score"],success:function(t){console.log("[getScore]","success",t),e(t.KVDataList[0]?parseInt(t.KVDataList[0].value):0)},fail:function(){console.log("[getScore]","fail"),e(-1)}})})},t.prototype.setScore=function(e){return i(this,void 0,void 0,function(){var t,o=this;return a(this,function(n){switch(n.label){case 0:return console.log("[setScore]",e),[4,this.getScore()];case 1:return t=n.sent(),console.log("[oldScore]",t),-1===t?(this.getRank(),[2]):(e>=t?window.wx.setUserCloudStorage({KVDataList:[{key:"score",value:e.toString()}],success:function(){console.log("[setScore]","success"),o.getRank()},fail:function(){console.log("[setScore]","fail"),o.getRank()}}):this.getRank(),[2])}})})},t.prototype.getRank=function(){return i(this,void 0,void 0,function(){var e=this;return a(this,function(t){switch(t.label){case 0:return console.log("[getRank]"),[4,new Promise(function(t){window.wx.getFriendCloudStorage({keyList:["score"],success:function(o){console.log("[getRank]","success",o),o.data.sort(function(e,t){return 0===e.KVDataList.length&&0===t.KVDataList.length?0:0===e.KVDataList.length?1:0===t.KVDataList.length?-1:parseInt(t.KVDataList[0].value)-parseInt(e.KVDataList[0].value)}),e.updateHomeRankList(o.data),t(null)},fail:function(e){console.log("[getRank]","fail:",e),t(null)}})})];case 1:return t.sent(),[2]}})})},t.prototype.showHomeRank=function(){this.homeRankNode.active=!0},t.prototype.hideHomeRank=function(){this.homeRankNode.active=!1},t.prototype.updateHomeRankList=function(e){for(var t=Math.max(e.length,this.homeContent.children.length),o=0;o<t;o++){if(e[o]&&this.homeContent.children[o])this.homeContent.children[o].active=!0,this.homeContent.children[o].getComponent(s.default).set(o+1,e[o]);else if(e[o]&&!this.homeContent.children[o]){var n=cc.instantiate(this.homeItemPrefab);n.active=!0,n.setParent(this.homeContent),n.getComponent(s.default).set(o+1,e[o])}else this.homeContent.children[o].active=!1;e[o]&&this.myNickName==e[o].nickname&&this.myItem.getComponent(l.default).set(o+1,e[o])}},c([h(cc.Node)],t.prototype,"homeRankNode",void 0),c([h(cc.Node)],t.prototype,"homeScrollView",void 0),c([h(cc.Node)],t.prototype,"homeContent",void 0),c([h(cc.Node)],t.prototype,"homeItemPrefab",void 0),c([h(cc.Node)],t.prototype,"myItem",void 0),c([p],t)}(cc.Component);o.default=f,cc._RF.pop()},{"./HomeRankItem":"HomeRankItem","./MyItem":"MyItem"}]},{},["HomeRankItem","MyItem","Rank"]);